x-monitor-common: &monitor-common
  build: .
  restart: unless-stopped
  environment: &monitor-env
    LOGS_DIR: /logs
    STATE_FILE: /state/position.txt
    BATCH_DIR: /state/batches
    PLAYERS_DB_FILE: ${PLAYERS_DB_FILE:-/state/players.json}
    ROTATE_MINUTES: ${ROTATE_MINUTES:-60}
    TZ: ${TZ:-Etc/UTC}
    WEBHOOK_TIMEOUT: ${WEBHOOK_TIMEOUT:-10}
    WEBHOOK_RETRIES: ${WEBHOOK_RETRIES:-3}
    WEBHOOK_RETRY_BACKOFF: ${WEBHOOK_RETRY_BACKOFF:-2}
    RAW_FILTER_EXCLUDE_SUBSTRINGS: ${RAW_FILTER_EXCLUDE_SUBSTRINGS:-}
    FILTER_EXCLUDE_SUBSTRINGS: ${FILTER_EXCLUDE_SUBSTRINGS:-}
  logging:
    driver: "json-file"
    options:
      max-size: "10m"
      max-file: "3"

services:
  dayz-log-monitor-1:
    <<: *monitor-common
    container_name: dayz-log-monitor-1
    volumes:
      - ${LOGS_HOST_PATH_1}:/logs:ro
      - ./state/server1:/state
    environment:
      <<: *monitor-env
      WEBHOOK_URL: ${WEBHOOK_URL_1}
      RAW_WEBHOOK_URL: ${RAW_WEBHOOK_URL_1:-}
      SOURCE_NAME: ${SOURCE_NAME_1:-server1}
      CHECK_INTERVAL: ${CHECK_INTERVAL_1:-30}
      QUIET_HOURS_RANGE: ${QUIET_HOURS_RANGE_1:-}
      SEND_INCLUDE_GROUPS: ${SEND_INCLUDE_GROUPS_1:-}

  dayz-log-monitor-2:
    <<: *monitor-common
    container_name: dayz-log-monitor-2
    volumes:
      - ${LOGS_HOST_PATH_2}:/logs:ro
      - ./state/server2:/state
    environment:
      <<: *monitor-env
      WEBHOOK_URL: ${WEBHOOK_URL_2}
      RAW_WEBHOOK_URL: ${RAW_WEBHOOK_URL_2:-}
      SOURCE_NAME: ${SOURCE_NAME_2:-server2}
      CHECK_INTERVAL: ${CHECK_INTERVAL_2:-30}
      QUIET_HOURS_RANGE: ${QUIET_HOURS_RANGE_2:-}
      SEND_INCLUDE_GROUPS: ${SEND_INCLUDE_GROUPS_2:-}

  dayz-log-monitor-test:
    <<: *monitor-common
    container_name: dayz-log-monitor-test
    volumes:
      - ${LOGS_HOST_PATH_TEST}:/logs:ro
      - ./state/test:/state
    environment:
      <<: *monitor-env
      WEBHOOK_URL: ${WEBHOOK_URL_TEST}
      RAW_WEBHOOK_URL: ${RAW_WEBHOOK_URL_TEST:-}
      SOURCE_NAME: ${SOURCE_NAME_TEST:-test}
      CHECK_INTERVAL: ${CHECK_INTERVAL_TEST:-30}
      QUIET_HOURS_RANGE: ${QUIET_HOURS_RANGE_TEST:-}
      SEND_INCLUDE_GROUPS: ${SEND_INCLUDE_GROUPS_TEST:-}

  dayz-log-monitor-test-2:
    <<: *monitor-common
    container_name: dayz-log-monitor-test-2
    volumes:
      - ${LOGS_HOST_PATH_TEST_2}:/logs:ro
      - ./state/test2:/state
    environment:
      <<: *monitor-env
      WEBHOOK_URL: ${WEBHOOK_URL_TEST_2}
      RAW_WEBHOOK_URL: ${RAW_WEBHOOK_URL_TEST_2:-}
      SOURCE_NAME: ${SOURCE_NAME_TEST_2:-test2}
      CHECK_INTERVAL: ${CHECK_INTERVAL_TEST_2:-30}
      QUIET_HOURS_RANGE: ${QUIET_HOURS_RANGE_TEST_2:-}
      SEND_INCLUDE_GROUPS: ${SEND_INCLUDE_GROUPS_TEST_2:-}
